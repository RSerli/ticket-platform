<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link th:rel="stylesheet" th:href="@{/webjars/bootstrap/5.1.3/css/bootstrap.min.css}" />
    <title>Ticket Service</title>
</head>

<body>
    <header>

        <nav th:replace="fragments/navbar :: navbar('Home')"></nav>

    </header>

    <main>

        <div class="container mt-3">
            <!-- heading di saluto -->
            <h2 th:text="|Ciao ${loggedUser.name}|"> </h2>

            <div class="contaier">
                <div class="row ">
                    <!-- parte di pagina dedicata ai ticket -->
                    <div class="col-12 col-md-8 border-end border-3">

                        <!-- Alert che non ci sono ticket legati all'user loggato -->
                        <th:block th:unless="${loggedUser.assignedTickets.size() > 0}">
                            <div class="alert alert-info" role="alert">
                                <div>Non ci sono ticket assegnati a te!</div>
                            </div>
                        </th:block>

                        <!-- Tabella dei ticket legati all'user loggato -->
                        <table th:if="${loggedUser.assignedTickets.size() > 0}" class="table table-striped">

                            <thead>
                                <tr>
                                    <th scope="col"></th> <!-- Header per il pulsante di view del ticket -->
                                    <th scope="col">Nome</th> <!-- Header per il nome del ticket -->
                                    <th scope="col">Status</th> <!-- Header per lo status del ticket -->
                                    <th scope="col"></th> <!-- Header per il pulsante aggiornamento status -->
                                    <th scope="col">Data Creazione</th>
                                    <!-- Header per la data di creazione del ticket -->
                                    <th scope="col"></th> <!-- Header per il pulsante aggiungi nota -->
                                </tr>
                            </thead>

                            <tbody>
                                <tr th:each="singoloTicket : ${loggedUser.assignedTickets}">
                                    <!-- cella pulsante della view -->
                                    <td>
                                        <a th:href="@{|/viewTicket/${singoloTicket.id}|}" class="btn btn-light">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
                                                <path
                                                    d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z" />
                                                <path
                                                    d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0" />
                                            </svg>
                                        </a>
                                    </td>
                                    <!-- cella dell nome del biglietto -->
                                    <td th:text="${singoloTicket.nome}"></td>
                                    <!-- cella dello status -->
                                    <td th:if="${singoloTicket.actualStatus.getId() == 1}">
                                        <span class="text-danger"
                                            th:text="${singoloTicket.actualStatus.getName()}"></span>
                                    </td>
                                    <td th:if="${singoloTicket.actualStatus.getId() == 2}">
                                        <span class="text-warning"
                                            th:text="${singoloTicket.actualStatus.getName()}"></span>
                                    </td>
                                    <td th:if="${singoloTicket.actualStatus.getId() == 3}">
                                        <span class="text-success"
                                            th:text="${singoloTicket.actualStatus.getName()}"></span>
                                    </td>
                                    <!-- cella pulsante di modifica stato-->
                                    <td>
                                        <div class="dropdown">
                                            <button class="btn btn-secondary dropdown-toggle" type="button"
                                                data-bs-toggle="dropdown" aria-expanded="false">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                    fill="currentColor" class="bi bi-arrow-repeat" viewBox="0 0 16 16">
                                                    <path
                                                        d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41m-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9" />
                                                    <path fill-rule="evenodd"
                                                        d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5 5 0 0 0 8 3M3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9z" />
                                                </svg>
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li th:each="singleStatus : ${allStatus}">
                                                    <form th:action="@{/changeStatus/{id} (id= ${singoloTicket.id})}"
                                                        method="post">
                                                        <button class="dropdown-item" type="submit"
                                                            th:name="newStatusId" th:text="${singleStatus.name}"
                                                            th:value="${singleStatus.id}">
                                                        </button>
                                                    </form>
                                                </li>
                                            </ul>
                                        </div>
                                    </td>
                                    <!-- cella della data di creazione -->
                                    <td th:text="${singoloTicket.createdAt}"></td>
                                    <!-- cella dper il bottone inserimento nota -->
                                    <td>
                                        <a class="btn btn-secondary"
                                            th:href="@{/{id}/AggiungiNota(id=${singoloTicket.id})}">
                                            Nuova Nota
                                        </a>
                                    </td>

                                </tr>
                            </tbody>

                        </table>
                    </div>
                </div>


            </div>


        </div>


    </main>

    <!-- Bootstrap Bundle with Popper -->
    <script th:src="@{/webjars/bootstrap/5.1.3/js/bootstrap.bundle.min.js}"></script>
</body>

</html>